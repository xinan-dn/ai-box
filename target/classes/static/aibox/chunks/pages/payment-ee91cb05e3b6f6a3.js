(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[252],{6121:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/payment",function(){return s(7354)}])},712:function(e,t,s){"use strict";var a,n,i,l,r,c,o,d,u,x;s.d(t,{EA:function(){return l},HY:function(){return a},SN:function(){return r},WA:function(){return n}}),(c=a||(a={})).WechatPayH5="WECHAT_PAY_H5",c.WechatPayJSAPI="WECHAT_PAY_JSAPI",c.WechatPayNative="WECHAT_PAY_NATIVE",(o=n||(n={})).Pending="pending",o.Completed="completed",o.Error="error",o.Expired="expired",o.Refunded="refunded",(d=i||(i={})).Active="active",d.Expired="expired",(u=l||(l={})).Free="free",u.Basic="basic",(x=r||(r={})).Subscription="subscription",x.Quota="quota"},4038:function(e,t,s){"use strict";s.d(t,{Z:function(){return C}});var a=s(7458),n=s(8194),i=s(712),l=s(6161),r=s(3474),c=s.n(r),o=s(40),d=s(2181),u=s(4039),x=s(741),m=s(3419),p=s(8651),h=s.n(p),f=s(6862),b=s(2983),g=s(3355),v=s(1411),j=s(7608),y=s.n(j);let w=e=>{let{children:t,onClick:s}=e;return(0,a.jsx)(v.ck,{disabled:void 0===s,onClick:s,className:"group relative flex h-[35px] cursor-pointer select-none items-center rounded-[3px] px-2 text-[16px] leading-none text-black outline-none data-[highlighted]:bg-black data-[highlighted]:text-white",children:t})},N=e=>{let{trigger:t,children:s,className:i,onOpenChange:r}=e;return(0,a.jsxs)(v.fC,{onOpenChange:r,children:[(0,a.jsx)(v.xz,{asChild:!0,children:(0,a.jsxs)(l.Z,{className:y()(i,"flex flex-row items-center gap-2"),children:[t,(0,a.jsx)(n.RYk,{})]})}),(0,a.jsx)(v.Uv,{children:(0,a.jsx)(v.VY,{className:"data-[side=top]:animate-slideDownAndFade data-[side=right]:animate-slideLeftAndFade data-[side=bottom]:animate-slideUpAndFade data-[side=left]:animate-slideRightAndFade min-w-[180px] rounded-md bg-white p-[5px] shadow-[0px_10px_38px_-10px_rgba(22,_23,_24,_0.35),_0px_10px_20px_-15px_rgba(22,_23,_24,_0.2)] will-change-[opacity,transform]",sideOffset:10,children:s})})]})},k=()=>{var e,t,s;let[r,p]=(0,m.KO)(g.Rx),[v,j]=(0,m.KO)(g.gr),y=(0,f.useRouter)(),k=(0,d.S)(),{openLoginDialog:C}=(0,x.Z)(),{openBindDialog:_}=(0,o.Z)(),{hideWechatLogin:q,hidePayment:A}=(0,u.Z)(),S=(0,b.useMemo)(()=>{var e;return(null===(e=k.data)||void 0===e?void 0:e.plan)!==i.EA.Free},[null===(e=k.data)||void 0===e?void 0:e.plan]),Z=(0,b.useMemo)(()=>"绑定".concat(r.phoneNumber?"微信":"手机号"),[r.phoneNumber]),E=(0,b.useCallback)(()=>{j({}),p({})},[j,p]),P=(0,b.useCallback)(()=>{_(r.phoneNumber?"wechat":"mobile")},[_,r.phoneNumber]),T=(0,b.useCallback)(e=>{if(e){y.push("/payment?itemType=".concat(e));return}y.push("/payment")},[y]);return(0,a.jsx)("nav",{className:"sticky top-0 left-0 z-10 w-full flex-none border-b border-slate-900/10 bg-white/80 backdrop-blur",children:(0,a.jsx)("div",{className:"max-w-8xl mx-auto",children:(0,a.jsx)("div",{className:"py-2 px-4",children:(0,a.jsxs)("div",{className:"relative flex h-10 items-center",children:[(0,a.jsx)(h(),{href:"/",className:"font-semibold text-black",children:(0,a.jsx)("img",{src:"/icon.png",width:140,height:40,alt:"icon"})}),(0,a.jsx)("div",{className:"ml-auto flex",children:v.accessToken&&(null==r?void 0:r.id)?(0,a.jsxs)(N,{onOpenChange:e=>e&&k.refetch(),className:S?"!bg-amber-400":"bg-black",trigger:(0,a.jsxs)("div",{className:"flex items-center truncate",children:[S&&(0,a.jsx)(n.$2U,{className:"mr-2"}),S?"会员":"用户",r.id.slice(16)]}),children:[S?(0,a.jsx)(w,{onClick:()=>T("quota"),children:(0,a.jsx)("div",{className:"plausible-event-name=NAV+PAYMENT+QUOTA",children:"购买次数包"})}):null,A?null:(0,a.jsx)(w,{onClick:()=>T(),children:(0,a.jsx)("div",{className:"plausible-event-name=NAV+PAYMENT",children:S?"续费会员时长":"升级会员"})}),S?(0,a.jsx)(w,{children:(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["剩余次数：",null===(t=k.data)||void 0===t?void 0:t.quotaAvailable]})}):null,S?(0,a.jsx)(w,{children:(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["会员到期：",(0,a.jsx)("span",{className:"text-xs",children:"".concat(c()(null===(s=k.data)||void 0===s?void 0:s.subscription.endsAt).format("YYYY/MM/DD"))})]})}):null,r.phoneNumber&&r.wechatUnionId||q?null:(0,a.jsx)(w,{onClick:P,children:Z}),(0,a.jsx)(w,{onClick:E,children:"退出登录"})]}):(0,a.jsx)(l.Z,{className:"plausible-event-name=LoginTrigger",onClick:()=>C("wechat"),children:"登录/注册"})})]})})})})};var C=(0,b.memo)(k)},40:function(e,t,s){"use strict";var a=s(3419),n=s(2983),i=s(3355);let l=()=>{let e=(0,a.b9)(i.l),t=(0,n.useCallback)(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"wechat";e({open:!0,method:t})},[e]),s=(0,n.useCallback)(()=>{e({open:!1,method:"wechat"})},[e]);return{openBindDialog:t,closeBindDialog:s,setBindDialogOpen:e}};t.Z=l},2181:function(e,t,s){"use strict";s.d(t,{S:function(){return o}});var a=s(2797),n=s(3419),i=s(2983),l=s(1911),r=s(3355),c=s(3121);function o(){let e=(0,n.Dv)(r.Rx),t=(0,l.Ek)("currentSubscription"),s=(0,c.Z)(),o=(0,i.useCallback)(async()=>{let e=await t();if(e.success)return e.membership;s({title:"获取订阅信息失败",description:e.toast},"fail")},[t,s]),d=(0,a.a)(["currentSubscription"],o,{staleTime:1/0,enabled:!!e.id});return d}},741:function(e,t,s){"use strict";var a=s(3419),n=s(2983),i=s(3355);let l=()=>{let e=(0,a.b9)(i.Sj),t=(0,n.useCallback)(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"wechat";e({open:!0,method:t})},[e]),s=(0,n.useCallback)(()=>{e({open:!1,method:void 0})},[e]);return{openLoginDialog:t,closeLoginDialog:s,setLoginDialogOpen:e}};t.Z=l},7354:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return B}});var a=s(7458),n=s(2983),i=s(4038),l=s(2181),r=s(4693),c=s(7382),o=s(712),d=s(3121),u=s(2501),x=s(3419),m=s(6862),p=s(1911),h=s(3355);function f(){let e=(0,p.Ek)("createCharge"),{isWechat:t}=(0,u.Z)(),s=(0,x.Dv)(h.Rx),a=(0,m.useRouter)(),i=(0,n.useMemo)(()=>a.query.code,[a.query]),l=(0,n.useMemo)(()=>a.query.state,[a.query]),f=(0,d.Z)(),b=(0,n.useMemo)(()=>t?o.HY.WechatPayJSAPI:o.HY.WechatPayH5,[t]),g=(0,n.useCallback)(async()=>(null==s?void 0:s.id)?!t||"done"===l||!!i||(f({title:"获取code失败",description:"请刷新页面后重试"},"fail"),!1):(f({title:"请先登录",description:"请先登录"},"fail"),!1),[i,t,l,f,null==s?void 0:s.id]),v=(0,n.useCallback)(async e=>{if(a.isReady)try{let s="".concat(window.location.origin,"/payment?state=done&chargeId=").concat(e.id),a=new URLSearchParams(t?{state:"init",midwayAppId:c.AF,wxAppId:c.ud,prepayData:JSON.stringify(e.prepayData),redirectUrl:s}:{state:"init",payUrl:e.prepayData.mweb_url,redirectUrl:s}),n="https://aime.okjike.com/global-redirect/payment?".concat(a.toString());setTimeout(()=>{window.location.replace(n)},0)}catch(t){r.Tb(t,{user:s,extra:{chargeId:e.id,code:i}}),f({title:"支付失败",description:"请重试"},"fail")}},[i,t,a.isReady,f,s]),j=(0,n.useCallback)(async s=>{if(!s||!g())return;let a=t&&i?(await (0,p.nW)(i)).openId:void 0;r.sU("openId",a);let n=await e({itemType:o.SN.Subscription,subscriptionOptionId:s,gateway:b,openId:a});n.success?v(n.charge):f({title:"支付失败",description:n.toast},"fail")},[g,i,e,b,t,v,f]),y=(0,n.useCallback)(async s=>{if(!g())return;let a=t&&i?(await (0,p.nW)(i)).openId:void 0;r.sU("openId",a);let n=await e({itemType:o.SN.Quota,quotaPackAmount:s,openId:a,gateway:b});n.success?v(n.charge):f({title:"支付失败",description:n.toast},"fail")},[g,i,e,b,t,v,f]);return{buyQuota:y,buySubscription:j}}var b=s(6161),g=s(3440),v=s(7608),j=s.n(v),y=[{id:"free",desc:["免费使用30次/月","每次生成一个结果","收藏常用的模板"]},{id:"basic",desc:["使用次数提升至500次/月","每次自动生成多个结果供选择","输入和输出字数大幅提升","优先体验最新工具模板","回看历史生成记录","收藏常用的模板"],label:"早鸟限时特价"}],w=s(8194),N=s(4039);let k={month:"月",year:"年"},C=e=>{var t;let{id:s,interval:i,intervalUnit:l,price:r,membership:c,isCurrentSubscription:o}=e,d=(0,n.useMemo)(()=>"\xa5".concat(r/100),[r]),x=(0,n.useMemo)(()=>null!==(t=i+(null==k?void 0:k[l]))&&void 0!==t?t:"",[i,l]),p=(0,n.useMemo)(()=>y.find(e=>e.id===c),[c]),{buySubscription:h,buyQuota:v}=f(),{disablePayment:C}=(0,N.Z)(),_=(0,n.useCallback)(async()=>{if(!C){if(e.checkPrerequisite){let t=await e.checkPrerequisite();if(!t)return}await h(s)}},[C,e,h,s]),q=(0,m.useRouter)(),{isWechat:A}=(0,u.Z)(),S=(0,n.useMemo)(()=>q.query.code,[q.query.code]);return(0,a.jsxs)("div",{className:j()(" relative flex min-h-[100px] w-[320px] flex-col items-center justify-start gap-y-10 rounded-lg bg-white p-4 pt-10 shadow-xl shadow-black/5 sm:h-[400px] ",o?"ring-2 ring-black":"bg-background-lines ring-1 ring-slate-700/10"),children:[(o||(null==p?void 0:p.label))&&(0,a.jsx)("div",{className:"absolute top-0 left-0 flex h-9 items-center justify-center rounded-tl-lg rounded-br-lg bg-black px-5",children:(0,a.jsx)("span",{className:"text-sm font-medium text-white",children:o?"当前计划":null==p?void 0:p.label})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-4xl font-medium sm:text-6xl",children:d}),(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["/",x]})]}),(0,a.jsx)("ul",{className:"flex flex-col gap-y-4 sm:gap-y-4",children:null==p?void 0:p.desc.map(e=>(0,a.jsxs)("li",{className:"flex items-center gap-x-1 text-xs sm:text-sm",children:[(0,a.jsx)(w.NhS,{}),(0,a.jsx)("span",{children:e})]},e))}),s?(0,a.jsxs)(b.Z,{onClick:_,className:"plausible-event-name=CLICK+PAYMENT flex w-5/6 items-center justify-center gap-x-2",children:[(0,a.jsx)(g.Z,{}),A&&!S?"微信授权后支付":"微信支付"]}):null]})};var _=(0,n.memo)(C);let q=()=>{var e;let t=(0,l.S)(),s=(0,n.useMemo)(()=>{var e;return!(null===(e=t.data)||void 0===e?void 0:e.subscription)},[null===(e=t.data)||void 0===e?void 0:e.subscription]);return(0,a.jsx)(_,{isCurrentSubscription:s,id:"",interval:1,intervalUnit:"month",price:0,membership:"free"})};var A=(0,n.memo)(q),S=s(7018),Z=s(2797);let E=e=>{let{chargeId:t}=e,[s,i]=(0,n.useState)(!1),l=function(e){let[t,s]=(0,n.useState)(500),a=(0,p.Ek)("getCharge"),i=(0,d.Z)(),l=(0,n.useCallback)(async()=>await a({id:e}),[e,a]),r=(0,m.useRouter)(),c=(0,Z.a)(["charge-state",e],l,{enabled:!!e,refetchInterval:t,refetchOnWindowFocus:!1,onSuccess:e=>{if(console.log(e),null==e?void 0:e.success){if(e.charge.state!==o.WA.Pending)switch(s(!1),e.charge.state){case o.WA.Completed:i({title:"交易成功"},"success"),r.push("/");break;case o.WA.Expired:i({title:"交易已过期"},"info");break;case o.WA.Error:i({title:"交易失败"},"fail")}}else i({title:"查询交易失败",description:null==e?void 0:e.toast},"fail"),s(!1)}});return c}(t),r=(0,m.useRouter)();return(0,n.useEffect)(()=>{var e;t&&(null===(e=l.data)||void 0===e?void 0:e.success)&&"completed"!==l.data.charge.state?i(!0):i(!1)},[t,l.data]),(0,a.jsx)(S.fC,{open:s,onOpenChange:i,children:(0,a.jsxs)(S.h_,{children:[(0,a.jsx)(S.aV,{className:"data-[state=open]:animate-overlayShow fixed inset-0 bg-black/50"}),(0,a.jsxs)(S.VY,{onInteractOutside:e=>e.preventDefault(),className:"data-[state=open]:animate-contentShow fixed top-[50%] left-[50%] h-[140px] w-[200px] -translate-x-1/2 -translate-y-1/2 rounded-lg bg-white p-[25px] focus:outline-none",children:[(0,a.jsx)(S.Dx,{className:"m-0 text-[17px] font-medium text-black",children:"请等待..."}),(0,a.jsxs)(S.dk,{className:"text-sm text-gray-500",children:["正在查询交易结果...",(0,a.jsx)("div",{className:"h-2"}),(0,a.jsx)(b.Z,{className:"border-2 border-gray-400 bg-white text-sm outline-none",onClick:()=>r.push("/"),children:(0,a.jsx)("span",{className:"text-black",children:"取消等待"})})]}),(0,a.jsx)("div",{className:"flex justify-center gap-x-10"}),(0,a.jsx)(S.x8,{asChild:!0,children:(0,a.jsx)("button",{className:"absolute top-[10px] right-[10px] inline-flex h-[25px] w-[25px] appearance-none items-center justify-center rounded-full text-black focus:outline-none","aria-label":"Close",children:(0,a.jsx)(w.Pxu,{})})})]})]})})};var P=(0,n.memo)(E),T=s(7410),I=s(1022);let M=e=>{let{open:t,onOpenChange:s}=e,{isWechat:i}=(0,u.Z)(),[l,r]=(0,n.useState)(""),c=(0,m.useRouter)();return(0,n.useEffect)(()=>{r("".concat(window.location.origin,"/payment"))},[]),(0,a.jsx)(S.fC,{open:t,onOpenChange:s,children:(0,a.jsxs)(S.h_,{children:[(0,a.jsx)(S.aV,{className:"data-[state=open]:animate-overlayShow fixed inset-0 bg-black/50"}),(0,a.jsxs)(S.VY,{onInteractOutside:e=>e.preventDefault(),className:"data-[state=open]:animate-contentShow fixed top-[50%] left-[50%] h-[503px] max-h-[85vh] w-[90vw] max-w-[480px] -translate-x-1/2 -translate-y-1/2 rounded-lg bg-white p-[25px] focus:outline-none",children:[(0,a.jsx)(S.Dx,{className:"m-0 text-base font-medium text-black",children:i?"登录微信":"内测中，目前仅支持微信支付"}),(0,a.jsx)(S.dk,{className:"text-sm text-gray-500",children:i?"完成支付流程需要微信授权":"在微信中扫描二维码打开网页后继续"}),(0,a.jsx)("div",{className:"flex justify-center gap-x-10",children:i?(0,a.jsx)("div",{className:"flex h-full flex-col items-center justify-center gap-y-4 sm:px-[45px]",children:(0,a.jsx)(T.Z,{method:"LOGIN",isInWechat:i})}):(0,a.jsxs)("div",{className:"mt-4 flex h-[360px] flex-col items-center justify-center gap-8",children:[(0,a.jsx)(I.Z,{size:300,value:l}),(0,a.jsx)(b.Z,{className:"border border-black bg-white focus:outline-none",onClick:()=>c.push("/"),children:(0,a.jsx)("span",{className:"font-normal text-black",children:"已完成请点击"})})]})})]})]})})};var O=(0,n.memo)(M);function R(e){let{isWechat:t}=(0,u.Z)(),s=(0,m.useRouter)(),i=(0,n.useMemo)(()=>s.query.code,[s.query.code]),{buyQuota:l}=f(),[r,c]=(0,n.useState)(1),o=(0,n.useCallback)(async()=>{await e.checkPrerequisite()&&l(r)},[l,e,r]);return(0,a.jsxs)("div",{className:"flex h-full flex-col items-center justify-center gap-y-4 p-4",children:[(0,a.jsx)("div",{className:"text-2xl font-semibold text-black",children:"购买次数"}),(0,a.jsxs)("div",{className:"relative flex min-h-[100px] w-[320px] flex-col items-center justify-start gap-y-10 rounded-lg bg-white p-4 pt-10 shadow-xl shadow-black/5 sm:h-[400px] ",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"text-4xl font-medium",children:[500*r,"次"]}),(0,a.jsxs)("span",{className:"text-3xl text-gray-500",children:["/\xa5",15*r]})]}),(0,a.jsxs)("ul",{className:"flex flex-col gap-y-4 sm:gap-y-4",children:[(0,a.jsx)("li",{className:"flex items-center gap-x-1 text-xs sm:text-sm",children:"有效期为90天"}),(0,a.jsx)("li",{className:"flex items-center gap-x-1 text-xs sm:text-sm",children:"会员额度用完后自动使用次数包"})]}),(0,a.jsxs)("div",{className:"flex w-full flex-row justify-end px-8",children:[(0,a.jsx)("span",{children:"数量："}),(0,a.jsxs)("div",{children:[(0,a.jsx)("a",{onClick:()=>c(e=>Math.max(e-1,1)),className:"cursor-pointer p-2",children:"-"}),(0,a.jsx)("input",{type:"text",className:"w-8 rounded-sm border-2 border-black px-1 text-end",value:r.toString(),onChange:e=>c(parseInt(e.target.value)||1)}),(0,a.jsx)("a",{onClick:()=>c(e=>e+1),className:"cursor-pointer p-2",children:"+"})]})]}),(0,a.jsxs)(b.Z,{onClick:o,className:"plausible-event-name=CLICK+PAYMENT flex w-5/6 items-center justify-center gap-x-2",children:[(0,a.jsx)(g.Z,{}),t&&!i?"微信授权后支付":"微信支付"]})]})]})}let D=e=>{var t;let s=(0,l.S)(),i=(0,n.useMemo)(()=>{var t;return(null===(t=s.data)||void 0===t?void 0:t.plan)===e.membership},[null===(t=s.data)||void 0===t?void 0:t.plan,e.membership]);return(0,a.jsx)(_,{...e,isCurrentSubscription:i})};var Y=(0,n.memo)(D),W=s(5918),U=s(9015),H=s(7531),F=s(40),V=s(741),L=s(5464);function B(){var e;let t=function(){let e=(0,p.Ek)("getSubscriptionOptions"),t=(0,d.Z)(),s=(0,n.useCallback)(async()=>{let s=await e();return s.success?s.subscriptionOptions:(t({title:"获取订阅列表失败",description:s.toast},"fail"),[])},[e,t]),a=(0,Z.a)(["subscriptionOptions"],s,{staleTime:1/0});return a}(),s=(0,m.useRouter)(),{open:l,setOpen:r,check:c}=function(){let e=(0,m.useRouter)(),{isWechat:t}=(0,u.Z)(),[s,a]=(0,n.useState)(!1),i=(0,x.Dv)(h.Rx),{openLoginDialog:l}=(0,V.Z)(),{openBindDialog:r}=(0,F.Z)(),c=(0,n.useCallback)(async()=>{if(!e.isReady||"done"===e.query.state)return!0;let s=(0,W.dU)(),n=s.device.isMobile&&!t;if(!(null==i?void 0:i.id)&&!n)return console.log("payment need login"),l("wechat"),!1;if(i.id&&!i.wechatUnionId&&!n)return console.log("payment need bind"),r("wechat"),!1;if(t){if(U.Z.isEmpty((0,H.C)(e.query,["itemType"]))){let t=encodeURIComponent(window.location.origin);return window.location.href="https://aibang.run/auth/get-wechat-code?domain=".concat(t,"&itemType=").concat(e.query.itemType),setTimeout(()=>{a(!0)},500),!1}}else if(s.device.isDesktop)return await new Promise(e=>setTimeout(e,500)),a(!0),!1;return!0},[t,r,l,e.isReady,e.query,i.id,i.wechatUnionId]);return{open:s,setOpen:a,check:c}}(),o=(0,d.Z)(),f=(0,n.useMemo)(()=>s.query&&s.query.chargeId?s.query.chargeId:"",[s]),{hidePayment:b}=(0,N.Z)(),{isWechat:g}=(0,u.Z)(),v=(0,n.useMemo)(()=>s.query&&s.query.state?s.query.state:"",[s]),j=(0,n.useMemo)(()=>s.query&&s.query.itemType?s.query.itemType:"",[s.query]);(0,n.useEffect)(()=>{s.query.code&&o({title:"授权成功",description:"请重新点击支付按钮"},"success")},[s.query.code,o]),(0,n.useEffect)(()=>{g&&b&&(0,L.qv)("/pages/index/subscribe")},[g,b]);let y=(0,a.jsxs)("div",{className:"flex h-full flex-col items-center justify-center gap-y-4 p-4",children:[(0,a.jsx)("div",{className:"text-lg font-semibold text-black",children:"付费选项"}),(0,a.jsxs)("div",{className:"flex h-full flex-wrap justify-center gap-4",children:[(0,a.jsx)(A,{}),null===(e=t.data)||void 0===e?void 0:e.map(e=>(0,n.createElement)(Y,{checkPrerequisite:c,...e,key:e.id}))]})]}),w=(0,a.jsx)("div",{className:"flex h-full flex-col items-center justify-center gap-y-4 p-4",children:(0,a.jsx)(R,{checkPrerequisite:c})});return(0,a.jsxs)("div",{className:"flex min-h-screen w-screen flex-col overflow-x-hidden bg-slate-50 text-black",children:[(0,a.jsx)(i.Z,{}),"quota"!==j?y:w,"done"===v&&f&&(0,a.jsx)(P,{chargeId:f}),(0,a.jsx)(O,{open:l,onOpenChange:r})]})}}},function(e){e.O(0,[848,335,558,774,888,179],function(){return e(e.s=6121)}),_N_E=e.O()}]);